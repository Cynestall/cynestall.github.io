<!DOCTYPE HTML>
<html>
	<head>
		<title>PCRec | Recommendations</title>
	  <link id="styleslink" rel="stylesheet" href="styles.css">
		<link href = "https://i.imgur.com/6LT5uPE.png" rel="shortcut icon">
		<link href="https://fonts.googleapis.com/css?family=Raleway|Ubuntu&display=swap" rel="stylesheet">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
	</head>
	<body>
      <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-164684948-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-164684948-1');
</script>

      <script type="text/javascript">
         function onButtonProto () {
            console.log("Prototype clicked!");
            gtag('js', new Date());
            gtag("event", "Prototype", {
               "event_category": "Recommendations"
            });
         }
      </script>
   <div id="content">
      <div class="colordecor1">
      <header id="header">
         <nav>

            <div class="navigation">

               <a href="index.html">
               <img class="pclogo" src="pclogo.svg">
                  </a>
               <ul class="navul">
                  <a href="info.html">
                     <li class="text">
                        Info
                     </li>
                  </a>

                  <a href="recommendations.html">
                     <li class="text">
                        Recommendations
                     </li>
                  </a>
               </ul>

               </div>
               <div class="menuicon" onclick="menuClick()">
                  <div class="line" id="line-1"></div>
                  <div class="line" id="line-2"></div>
                  <div class="line" id="line-3"></div>
               </div>    
            </nav>   

            <div id="menu">
          <ul>
               <a href="index.html">
                  <li class="text">
                     Home
                  </li>
               </a>
               <hr>
               <a href="info.html">
                  <li class="text">
                     Info
                  </li>
               </a>
               <hr>
               <a href="recommendations.html">
                  <li class="text">
                     Recommendations
                  </li>
               </a>
               </ul>
      </div>

      </header>

       <div class="centercolor">
      <div class="centerrecom" id="centerdiv">

      <h2 id="recommendations">Recommendations</h2>
      <img id="back" onclick="backList()" src="https://image.flaticon.com/icons/svg/709/709606.svg">
      <br>
      <br>
      <div class="recom-content">
         <div id="recom-search">

               <div class="price-search">
                  Price:
                  <div class="price-range-values-div">
                     <input type="number" name="min" placeholder="0" class="price-range-values" oninput="setMin(this.value)" id="min">
                     -
                     <input type="number" name="max" placeholder="0" class="price-range-values" oninput="setMax(this.value)" id="max">
                  </div>

                  <br>

                  <div id="range-slider"></div>
                  <br>
                     Sort by: 
                     <select name="sort" id="sort-by">
                        <option value="expensive">Most expensive first</option>
                        <option value="cheap">Cheapest first</option>
                        <option value="name">By name</option>
                     </select>
                  <button onclick="listSearch()" id="search-button">Search</button>
               </div>

               <!--<div id="cpu-search">
                  CPU:
               </div>
               <button type="button" onclick="listCpuSearch()">Search</button>
               <br>
               <div id="gpu-search">
                  GPU:
               </div>
               <button type="button" onclick="listGpuSearch()">Search</button> -->

         </div>

         <div id="recomList">

         </div>
      </div>
      <div id="product-area">
         <h1 class="pcname" id="pcnamephone"></h1>
         <div class="product-image">
         </div>

         <div class="product-text-area">
            <div class="product-text">
               <h1 class="pcname" id="pcnameproduct"></h1>

               <div class="product-text-p">
                  <p>CPU: <span id="gpu"></span></p>
                  <p>GPU: <span id="cpu"></span></p>
                  <p>RAM: <span id="ram"></span></p>
               </div>
               <p class="price"><span id="priceproduct"></span>€</p>
               <br>
               <button type="button" class="order-button">Order</button>
            </div>
         </div>

     </div>



      <div class="recomspacing">
      </div>

   </div>
   </div>
   </div>

<br>

<footer>

   <div class="footer-left">
      <strong>© 2020 PCRec OÜ</strong>
   </div>


   <ul class="footer-right">
      <li>
         <a href="recommendations.html">
            Recommendations
         </a>
      </li>

      <li>
         <a href="info.html">
            Info
         </a>
      </li>

   </ul>
 </footer>
   </div>

   <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>

   <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
   <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>

   <script>
     // Your web app's Firebase configuration
     // For Firebase JS SDK v7.20.0 and later, measurementId is optional
     var firebaseConfig = {
       apiKey: "AIzaSyA0_nRIUhAlt-NYBeoKW8mldVQke1ECHYw",
       authDomain: "pcrec-48430.firebaseapp.com",
       projectId: "pcrec-48430",
       storageBucket: "pcrec-48430.appspot.com",
       messagingSenderId: "541513880117",
       appId: "1:541513880117:web:ee3c2eddadb52e7d1bd77c",
       measurementId: "G-S91YFTN9BW"
     };
     // Initialize Firebase
     firebase.initializeApp(firebaseConfig);
     firebase.analytics();
   </script>

   <script src="javascript.js"></script>
   <script type="text/javascript">
      var db = firebase.firestore();
      var computerList = [];

      function updateList()  {
         for (var i = 0; i < computerList.length; i++) {
            var computer_dict = {
               "id": computerList[i].id,
               "name": computerList[i].name,
               "imgURL": computerList[i].imgURL,
               "price": computerList[i].price,
               "cpu": computerList[i].cpu,
               "gpu": computerList[i].gpu,
               "ram": computerList[i].ram
            }

            db.collection("computers").doc(i.toString()).set(computer_dict)
            .then((docRef) => {
               console.log("computer sent");
            })
            .catch((error) => {
               console.error("Error adding document: ", error);
            });
         }
      }
      updateList();

      async function makeComputerList() {
         db.collection("computers").onSnapshot((querySnapshot) => {
            querySnapshot.forEach((doc) => {
               computerList.push(doc.data());
               loadProducts(computerList.length - 1);
            });
         });
      }

      async function callList() {
         await makeComputerList();
         console.log("callList done");
         return;
      }

      callList();

      var showingProducts = [];

      function loadProducts(index) {
         showingProducts.push(computerList[index]);

         var div = document.createElement("DIV");
         div.classList.add("recomItem");

         var namep = document.createElement("P");
         namep.classList.add("pcname");
         namep.innerHTML = computerList[index].name;

         var img = document.createElement("IMG");
         img.src = computerList[index].imgURL;
         img.setAttribute("onclick", "showProduct("+ index +")");

         var price = document.createElement("P");
         price.classList.add("price");
         price.innerHTML = computerList[index].price + "€";

         var cpu = document.createElement("P");
         cpu.innerHTML = computerList[index].cpu;

         var gpu = document.createElement("P");
         gpu.innerHTML = computerList[index].gpu;

         var ram = document.createElement("P");
         ram.innerHTML = computerList[index].ram;

         div.appendChild(namep);
         div.appendChild(img);
         div.appendChild(price);
         div.appendChild(cpu);
         div.appendChild(gpu);
         div.appendChild(ram);

         document.getElementById("recomList").appendChild(div);
         findMax();
      }

      function showProduct (id) {
         document.getElementById("recomList").style.display = "none";

         document.getElementById("recom-search").style.display = "none";

         document.getElementsByClassName("product-image")[0].style.backgroundImage = "url(" + computerList[id].imgURL + ")";

         document.getElementById("pcnameproduct").innerHTML = computerList[id].name;

         document.getElementById("pcnamephone").innerHTML = computerList[id].name;

         document.getElementById("priceproduct").innerHTML = computerList[id].price;

         document.getElementById("cpu").innerHTML = computerList[id].cpu;

         document.getElementById("gpu").innerHTML = computerList[id].gpu;

         document.getElementById("ram").innerHTML = computerList[id].ram;

         document.getElementById("recommendations").style.display = "none";
         document.getElementById("back").style.display = "inline-block";

         document.getElementById("product-area").style.display = "flex";
         document.title = "PCRec | " + computerList[id].name;
      }

      function backList () {
         document.getElementById("recom-search").style.display = "block";
         document.getElementById("recommendations").style.display = "inline-block";
         document.getElementById("back").style.display = "none";

         document.getElementById("recomList").style.display = "flex";
         document.getElementById("product-area").style.display = "none";

         document.title = "PCRec | Recommendations";
      }

      var maximum = 0;

      function findMax() {
         for(var i = 0; i < computerList.length; i++) {
            if (computerList[i].price > maximum) {
               maximum = computerList[i].price;
            }
         }

         $("#min").val(0);
         $("#max").val(maximum);

         $( function() {
            $("#range-slider").slider({
               range: true,
               min: 0,
               max: maximum,
               values: [0, maximum],
               slide: function( event, ui ) {
                  $("#min").val(ui.values[0]);
                  $("#max").val(ui.values[1]);  
               }
            });
         });
      }

      function setMin (val) {

         if (val > 0 && val < $("#range-slider").slider("values", 1)) {
            $("#range-slider").slider("values", 0, val);
         };
         if (val === "") {
            $("#range-slider").slider("values", 0, 0);
         }
      }

      function setMax (val) {
         if (val > $("#range-slider").slider("values", 0) && val <= maximum) {
            $("#range-slider").slider("values", 1, val);
         };
         if (val === "") {
            $("#range-slider").slider("values", 1, 0);
         }
         if (val > maximum) {
            $("#range-slider").slider("values", 1, maximum);
            $("#max").val(maximum);
         }
      }

      function listSearch () {

         $("#recomList").html("");

         showingProducts = [];

         for (var index = 0; index < computerList.length; index++) {

            if (computerList[index].price >= $("#range-slider").slider("values", 0) && computerList[index].price <= $("#range-slider").slider("values", 1)) {
               showingProducts.push(computerList[index]);
            }

            if (document.getElementById("sort-by").value == "cheap")  {
               showingProducts.sort(function (a,  b) {
                  if (a.price > b.price) {
                     return 1;
                  }
                  if (a.price < b.price) {
                     return -1;
                  }
                  return 0;
               });
            } else if (document.getElementById("sort-by").value == "expensive") {
               showingProducts.sort(function (a,  b) {
                  if (a.price < b.price) {
                     return 1;
                  }
                  if (a.price > b.price) {
                     return -1;
                  }
                  return 0;
               });
            } else if (document.getElementById("sort-by").value == "name") {
               showingProducts.sort(function (a,  b) {
                  if (a.name > b.name) {
                     return 1;
                  }
                  if (a.name < b.name) {
                     return -1;
                  }
                  return 0;
               });
            }
            }

         for (var index = 0; index <  showingProducts.length; index++) {
            var div = document.createElement("DIV");
               div.classList.add("recomItem");

               var namep = document.createElement("P");
               namep.classList.add("pcname");
               namep.innerHTML = showingProducts[index].name;

               var img = document.createElement("IMG");
               img.src = showingProducts[index].imgURL;
               img.setAttribute("onclick", "showProduct("+ showingProducts[index].id +")");

               var price = document.createElement("P");
               price.classList.add("price");
               price.innerHTML = showingProducts[index].price + "€";

               var cpu = document.createElement("P");
               cpu.innerHTML = showingProducts[index].cpu;

               var gpu = document.createElement("P");
               gpu.innerHTML = showingProducts[index].gpu;

               var ram = document.createElement("P");
               ram.innerHTML = showingProducts[index].ram;

               div.appendChild(namep);
               div.appendChild(img);
               div.appendChild(price);
               div.appendChild(cpu);
               div.appendChild(gpu);
               div.appendChild(ram);

               document.getElementById("recomList").appendChild(div);
         }
      }

      // var div = document.createElement("DIV");
      //          div.classList.add("recomItem");

      //          var namep = document.createElement("P");
      //          namep.classList.add("pcname");
      //          namep.innerHTML = computerList[index].name;

      //          var img = document.createElement("IMG");
      //          img.src = computerList[index].imgURL;
      //          img.setAttribute("onclick", "showProduct("+ index +")");

      //          var price = document.createElement("P");
      //          price.classList.add("price");
      //          price.innerHTML = computerList[index].price + "$";

      //          var cpu = document.createElement("P");
      //          cpu.innerHTML = computerList[index].cpu;

      //          var gpu = document.createElement("P");
      //          gpu.innerHTML = computerList[index].gpu;

      //          var ram = document.createElement("P");
      //          ram.innerHTML = computerList[index].ram;

      //          div.appendChild(namep);
      //          div.appendChild(img);
      //          div.appendChild(price);
      //          div.appendChild(cpu);
      //          div.appendChild(gpu);
      //          div.appendChild(ram);

      //          document.getElementById("recomList").appendChild(div);







      // var itemListCpu = [];

      // var newItemListCpu = [];


      // function loadCpuSearch () {

      //    var item;

      //    for(var i = 0; i < computerList.length; i++) {

      //       item = computerList[i].cpu;

      //       itemListCpu.push(item);

      //    }

      //    newItemListCpu = itemListCpu.filter((elem, i, arr) => {

      //       if (arr.indexOf(elem) === i) {
      //          return elem;
      //       };

      //    });

      //    for (var j = 0; j < newItemListCpu.length; j++) {

      //       var div = document.createElement("DIV");
      //       $(div).addClass("cpu-search-div");

      //       var input = document.createElement("INPUT");
      //       $(input).attr("type", "checkbox");
      //       $(input).attr("id", "cpu-" + j);

      //       var label = document.createElement("LABEL");
      //       $(label).attr("for", "cpu-" + j);
      //       $(label).html(itemListCpu[j]);

      //       var br = document.createElement("BR");

      //       $(div).append(input);
      //       $(div).append(label);

      //       $("#cpu-search").append(div);


      //    }

      // }

      // loadCpuSearch();

      // function listCpuSearch () {

      //    $("#recomList").html("");

      //    for (var i = 0; i < newItemListCpu.length; i++) {


      //       if($("#cpu-" + i).prop("checked") === true) {

      //          var a = itemListCpu.indexOf(newItemListCpu[i]);

      //          var b = [];

      //          b.push(a);

      //          while(a >= 0) {
                     
      //                a = itemListCpu.indexOf(newItemListCpu[i], a+1);

      //                if (a >= 0) {
      //                   b.push(a);
      //                }
      //          }
      //          for(var j = 0; j < b.length; j++) {

      //                   var div = document.createElement("DIV");
      //                   div.classList.add("recomItem");

      //                   var namep = document.createElement("P");
      //                   namep.classList.add("pcname");
      //                   namep.innerHTML = computerList[b[j]].name;

      //                   var img = document.createElement("IMG");
      //                   img.src = computerList[b[j]].imgURL;
      //                   img.setAttribute("onclick", "showProduct("+ b[j] +")");

      //                   var price = document.createElement("P");
      //                   price.classList.add("price");
      //                   price.innerHTML = computerList[b[j]].price + "$";

      //                   var cpu = document.createElement("P");
      //                   cpu.innerHTML = computerList[b[j]].cpu;

      //                   var gpu = document.createElement("P");
      //                   gpu.innerHTML = computerList[b[j]].gpu;

      //                   var ram = document.createElement("P");
      //                   ram.innerHTML = computerList[b[j]].ram;

      //                   div.appendChild(namep);
      //                   div.appendChild(img);
      //                   div.appendChild(price);
      //                   div.appendChild(cpu);
      //                   div.appendChild(gpu);
      //                   div.appendChild(ram);

      //                   document.getElementById("recomList").appendChild(div);

      //                }

      //       }

      //    }
      // }



      // var itemListGpu = [];

      // var newItemListGpu = [];


      // function loadGpuSearch () {

      //    var item;

      //    for(var i = 0; i < computerList.length; i++) {

      //       item = computerList[i].gpu;

      //       itemListGpu.push(item);

      //    }

      //    newItemListGpu = itemListGpu.filter((elem, i, arr) => {

      //       if (arr.indexOf(elem) === i) {
      //          return elem;
      //       };

      //    });

      //    for (var j = 0; j < newItemListGpu.length; j++) {

      //       var div = document.createElement("DIV");
      //       $(div).addClass("gpu-search-div");

      //       var input = document.createElement("INPUT");
      //       $(input).attr("type", "checkbox");
      //       $(input).attr("id", "gpu-" + j);

      //       var label = document.createElement("LABEL");
      //       $(label).attr("for", "gpu-" + j);
      //       $(label).html(itemListGpu[j]);

      //       var br = document.createElement("BR");

      //       $(div).append(input);
      //       $(div).append(label);

      //       $("#gpu-search").append(div);


      //    }

      // }

      // loadGpuSearch();

      // function listGpuSearch () {


      //    $("#recomList").html("");

      //    for (var i = 0; i < newItemListGpu.length; i++) {

      //       if ($("#gpu-" + i).prop("checked") === true) {

      //          var a = itemListGpu.indexOf(newItemListGpu[i]);

      //          var b = [];

      //          b.push(a);

      //          while(a >= 0) {
                     
      //                a = itemListGpu.indexOf(newItemListGpu[i], a+1);

      //                if (a >= 0) {
      //                   b.push(a);
      //                }
      //          }

      //             for(var j = 0; j < b.length; j++) {

      //                      var div = document.createElement("DIV");
      //                      div.classList.add("recomItem");

      //                      var namep = document.createElement("P");
      //                      namep.classList.add("pcname");
      //                      namep.innerHTML = computerList[b[j]].name;

      //                      var img = document.createElement("IMG");
      //                      img.src = computerList[b[j]].imgURL;
      //                      img.setAttribute("onclick", "showProduct("+ b[j] +")");

      //                      var price = document.createElement("P");
      //                      price.classList.add("price");
      //                      price.innerHTML = computerList[b[j]].price + "$";

      //                      var cpu = document.createElement("P");
      //                      cpu.innerHTML = computerList[b[j]].cpu;

      //                      var gpu = document.createElement("P");
      //                      gpu.innerHTML = computerList[b[j]].gpu;

      //                      var ram = document.createElement("P");
      //                      ram.innerHTML = computerList[b[j]].ram;

      //                      div.appendChild(namep);
      //                      div.appendChild(img);
      //                      div.appendChild(price);
      //                      div.appendChild(cpu);
      //                      div.appendChild(gpu);
      //                      div.appendChild(ram);

      //                      document.getElementById("recomList").appendChild(div);

      //             }

      //       }
      //    }
      // }



   </script>
	</body>
   </html>